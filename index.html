<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>مولد السيرة الذاتية</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; direction: rtl; padding: 20px; }
    label, input, select, textarea { display: block; margin-bottom: 10px; width: 100%; max-width: 400px; }
    .hidden { display: none; }
    .button { margin-top: 10px; padding: 10px 20px; background: #28a745; color: white; border: none; cursor: pointer; border-radius: 5px; }
    .button-secondary { background: #007bff; margin-left: 10px; }
    #form-section, #preview-section { margin-top: 20px; }
  </style>
</head>
<body>
  <h2>مولد السيرة الذاتية</h2>

  <div id="form-section">
    <label>اختر اللغة:
      <select id="language">
        <option value="ar">العربية</option>
        <option value="en">English</option>
        <option value="fr">Français</option>
      </select>
    </label>
    <button class="button" onclick="startForm()">ابدأ</button>
  </div>

  <div id="preview-section" class="hidden">
    <label>الاسم الكامل: <input type="text" id="fullName"></label>
    <label>المسمى الوظيفي: <input type="text" id="jobTitle"></label>
    <label>البريد الإلكتروني: <input type="email" id="email"></label>
    <label>رقم الهاتف: <input type="tel" id="phone"></label>
    <label>المهارات: <textarea id="skills"></textarea></label>
    <label>اللغات:
      <input type="text" id="languages" placeholder="مثال: العربية (متقدمة)، الإنجليزية (متوسطة)">
    </label>
    <label>الصورة الشخصية: <input type="file" id="photo"></label>
    <fieldset>
      <legend>إظهار/إخفاء الحقول:</legend>
      <label><input type="checkbox" id="showPhoto" checked> الصورة</label>
      <label><input type="checkbox" id="showSkills" checked> المهارات</label>
      <label><input type="checkbox" id="showPhone" checked> رقم الهاتف</label>
      <label><input type="checkbox" id="showLanguages" checked> اللغات</label>
    </fieldset>
    <button class="button" onclick="generatePDF()">معاينة وتحميل</button>
    <button class="button-secondary button" onclick="goBack()">رجوع</button>
  </div>

  <script>
    function startForm() {
      document.getElementById("form-section").classList.add("hidden");
      document.getElementById("preview-section").classList.remove("hidden");
    }

    function goBack() {
      document.getElementById("preview-section").classList.add("hidden");
      document.getElementById("form-section").classList.remove("hidden");
    }

    async function generatePDF() {
      const {{ jsPDF }} = window.jspdf;
      const doc = new jsPDF();

      const fullName = document.getElementById("fullName").value;
      const jobTitle = document.getElementById("jobTitle").value;
      const email = document.getElementById("email").value;
      const phone = document.getElementById("phone").value;
      const skills = document.getElementById("skills").value;
      const languages = document.getElementById("languages").value;

      const showPhoto = document.getElementById("showPhoto").checked;
      const showSkills = document.getElementById("showSkills").checked;
      const showPhone = document.getElementById("showPhone").checked;
      const showLanguages = document.getElementById("showLanguages").checked;

      const photoFile = document.getElementById("photo").files[0];

      let content = `الاسم الكامل: ${fullName}
المسمى الوظيفي: ${jobTitle}
البريد الإلكتروني: ${email}`;
      if (showPhone) content += `
رقم الهاتف: ${phone}`;
      if (showSkills) content += `
المهارات:
${skills}`;
      if (showLanguages) content += `
اللغات:
${languages}`;

      function saveAndShowShare(doc) {
        doc.save("cv.pdf");
        if (navigator.share) {
          navigator.share({
            title: "سيرتي الذاتية",
            text: "اطلع على سيرتي الذاتية",
            url: window.location.href
          }).catch(err => console.error("خطأ في المشاركة: " + err));
        } else {
          alert("ميزة المشاركة غير مدعومة في متصفحك.");
        }
      }

      if (showPhoto && photoFile) {
        const reader = new FileReader();
        reader.onload = function(event) {
          const imgData = event.target.result;
          doc.addImage(imgData, 'JPEG', 150, 10, 40, 40);
          doc.text(content, 10, 60);
          saveAndShowShare(doc);
        };
        reader.readAsDataURL(photoFile);
      } else {
        doc.text(content, 10, 10);
        saveAndShowShare(doc);
      }
    }
  </script>
</body>
</html>
